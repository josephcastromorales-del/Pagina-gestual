<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TechOS - Invisible Control</title>
    <style>
        :root { --accent: #00ffcc; --bg: #050505; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }
        
        /* Contenedor principal FIJO y CENTRADO */
        #main-stage {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 380px; height: 600px;
            border: 3px solid var(--accent); border-radius: 40px;
            overflow: hidden; background: #000;
            box-shadow: 0 0 40px rgba(0, 255, 204, 0.1);
        }

        #cards-track {
            display: flex; height: 100%; width: 100%;
            transition: transform 0.6s cubic-bezier(0.2, 1, 0.3, 1);
        }

        .card {
            min-width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: linear-gradient(180deg, #111 0%, #000 100%);
            border-right: 1px solid #222;
        }

        .card h1 { font-size: 6rem; color: var(--accent); margin-bottom: 20px; }
        .card p { letter-spacing: 5px; opacity: 0.7; }

        /* Cámara pequeña y discreta */
        #camera-feed { position: fixed; bottom: 20px; right: 20px; width: 100px; opacity: 0.4; }
        #input_video { width: 100%; transform: scaleX(-1); border-radius: 10px; border: 1px solid #333; }
        
        #activate-btn {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            padding: 15px 40px; background: var(--accent); color: black;
            border: none; border-radius: 50px; font-weight: bold; cursor: pointer;
        }
    </style>
</head>
<body>

    <button id="activate-btn">INICIAR CONTROL INVISIBLE</button>

    <div id="camera-feed"><video id="input_video" playsinline></video></div>

    <div id="main-stage">
        <div id="cards-track">
            <div class="card" data-url="https://youtube.com"><h1>01</h1><p>YOUTUBE</p></div>
            <div class="card" data-url="https://google.com"><h1>02</h1><p>SEARCH</p></div>
            <div class="card" data-url="https://github.com"><h1>03</h1><p>CODE</p></div>
            <div class="card" data-url="#"><h1>04</h1><p>CONFIG</p></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        let currentIndex = 0;
        let lastHandX = 0;
        let canSwipe = true;
        let canClick = true;

        const track = document.getElementById('cards-track');
        const cards = document.querySelectorAll('.card');

        function updateShorts() {
            track.style.transform = `translateX(-${currentIndex * 100}%)`;
        }

        function onResults(res) {
            if (res.multiHandLandmarks && res.multiHandLandmarks[0]) {
                const hand = res.multiHandLandmarks[0];
                const thumb = hand[4], index = hand[8];

                // --- LÓGICA DE SWIPE GLOBAL ---
                const currentHandX = index.x;
                const deltaX = currentHandX - lastHandX;

                // Detecta movimiento rápido (Swipe)
                if (canSwipe && Math.abs(deltaX) > 0.15) {
                    if (deltaX > 0 && currentIndex > 0) { // Swipe Mano a la Derecha -> Tarjeta Anterior
                        currentIndex--;
                        canSwipe = false;
                    } else if (deltaX < 0 && currentIndex < cards.length - 1) { // Swipe Mano a la Izquierda -> Siguiente Tarjeta
                        currentIndex++;
                        canSwipe = false;
                    }
                    updateShorts();
                    // Tiempo de espera para el siguiente swipe
                    setTimeout(() => canSwipe = true, 500);
                }
                lastHandX = currentHandX;

                // --- LÓGICA DE CLICK GLOBAL (Pellizco) ---
                const distance = Math.hypot(index.x - thumb.x, index.y - thumb.y);
                if (distance < 0.05 && canClick) {
                    const activeCard = cards[currentIndex];
                    const url = activeCard.getAttribute('data-url');
                    
                    console.log("Abriendo:", url);
                    if (url && url !== "#") window.open(url, '_blank');
                    
                    canClick = false;
                    setTimeout(() => canClick = true, 1000); // Evita clics repetidos
                }
            }
        }

        document.getElementById('activate-btn').onclick = function() {
            this.style.display = 'none';
            const hands = new Hands({ locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}` });
            hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.75 });
            hands.onResults(onResults);

            new Camera(document.getElementById('input_video'), {
                onFrame: async () => { await hands.send({image: document.getElementById('input_video')}); },
                width: 640, height: 480
            }).start();
        };
    </script>
</body>
</html>
