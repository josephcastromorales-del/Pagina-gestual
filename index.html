<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TechOS - Finger Counter Navigation</title>
    <style>
        :root { --accent: #00ffcc; --bg: #050505; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }
        
        #main-stage {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 380px; height: 600px;
            border: 3px solid #222; border-radius: 40px;
            overflow: hidden; background: #000;
        }

        #cards-track {
            display: flex; height: 100%; width: 100%;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.2);
        }

        .card {
            min-width: 100%; height: 100%;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            background: #111;
        }
        .card.active { border: 2px solid var(--accent); }
        .card h1 { font-size: 8rem; color: var(--accent); }
        
        /* Indicador de dedos detectados */
        #finger-count-ui {
            position: fixed; top: 20px; right: 20px;
            font-size: 2rem; color: var(--accent);
            background: rgba(0,255,204,0.1); padding: 10px 20px; border-radius: 20px;
        }

        #camera-feed { position: fixed; bottom: 20px; left: 20px; width: 150px; opacity: 0.5; }
        #input_video { width: 100%; transform: scaleX(-1); border-radius: 15px; border: 2px solid #333; }
        #activate-btn { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 15px 40px; background: var(--accent); border: none; border-radius: 50px; font-weight: bold; cursor: pointer; z-index: 100; }
    </style>
</head>
<body>

    <button id="activate-btn">INICIAR SENSOR DACTILAR</button>
    <div id="finger-count-ui">Dedos: 0</div>

    <div id="camera-feed"><video id="input_video" playsinline></video></div>

    <div id="main-stage">
        <div id="cards-track">
            <div class="card" data-url="https://youtube.com"><h1>1</h1><p>YOUTUBE</p></div>
            <div class="card" data-url="#"><h1>2</h1><p>PROYECTOS</p></div>
            <div class="card" data-url="#"><h1>3</h1><p>SISTEMA</p></div>
            <div class="card" data-url="#"><h1>4</h1><p>CONFIG</p></div>
            <div class="card" data-url="#"><h1>5</h1><p>REDES</p></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        let currentIndex = 0;
        let canClick = true;
        const track = document.getElementById('cards-track');
        const uiCount = document.getElementById('finger-count-ui');

        function onResults(res) {
            if (res.multiHandLandmarks && res.multiHandLandmarks[0]) {
                const hand = res.multiHandLandmarks[0];
                
                // LÓGICA DE CONTEO DE DEDOS
                // Comparamos la punta del dedo (Tip) con el nudillo (PIP/MCP)
                const fingerTips = [8, 12, 16, 20]; // Índice, Medio, Anular, Meñique
                let count = 0;

                // Dedos normales
                fingerTips.forEach(tip => {
                    if (hand[tip].y < hand[tip - 2].y) count++;
                });

                // Pulgar (Lógica especial: eje X)
                // Depende de si es mano izquierda o derecha (usamos comparación simple aquí)
                if (Math.abs(hand[4].x - hand[2].x) > 0.05) count++;

                uiCount.innerText = `Dedos: ${count}`;

                // SALTO DIRECTO
                if (count > 0 && count <= 5) {
                    currentIndex = count - 1;
                    track.style.transform = `translateX(-${currentIndex * 100}%)`;
                }

                // CLICK (Pellizco mantenido: Índice + Pulgar)
                const thumb = hand[4], index = hand[8];
                const dist = Math.hypot(index.x - thumb.x, index.y - thumb.y);
                
                if (dist < 0.04 && canClick) {
                    const cards = document.querySelectorAll('.card');
                    const url = cards[currentIndex].getAttribute('data-url');
                    if (url !== "#") window.open(url, '_blank');
                    canClick = false;
                    setTimeout(() => canClick = true, 1000);
                }
            }
        }

        document.getElementById('activate-btn').onclick = function() {
            this.style.display = 'none';
            const hands = new Hands({ locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}` });
            hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.8 });
            hands.onResults(onResults);

            new Camera(document.getElementById('input_video'), {
                onFrame: async () => { await hands.send({image: document.getElementById('input_video')}); },
                width: 640, height: 480
            }).start();
        };
    </script>
</body>
</html>
